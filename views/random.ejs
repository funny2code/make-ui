<!DOCTYPE html>
<html>
    <head>
        <title><%= make.title %></title>
        <link rel='stylesheet' href='/stylesheets/style.css' />
        <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&display=swap" rel="stylesheet">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <%- include('make/header-random', {id: id, show: true }) %>
        <div class="py__make">
            <div class="py__make-preview">
                <div class="py__preview-random-content">
                    <div class="py__preview-iframe py__preview-random-iframe py__preview-iframe-desktop">
                        <iframe src="/view/<%=id%>?page=<%=page_handle%>" class="py__view-iframe" scrolling="auto" sandbox="allow-same-origin allow-forms allow-popups allow-scripts allow-modals"></iframe>
                    </div>
                    <div class="py__preview-iframe py__preview-random-iframe py__preview-iframe-tablet">
                        <iframe src="/view/<%=id%>?page=<%=page_handle%>" class="py__view-iframe" scrolling="auto" sandbox="allow-same-origin allow-forms allow-popups allow-scripts allow-modals"></iframe>
                    </div>
                    <div class="py__preview-iframe py__preview-random-iframe py__preview-iframe-mobile">
                        <iframe src="/view/<%=id%>?page=<%=page_handle%>" class="py__view-iframe" scrolling="auto" sandbox="allow-same-origin allow-forms allow-popups allow-scripts allow-modals"></iframe>
                    </div>
                </div>
            </div>
        </div>
        <div class="py__make-settings py__make-random-settings">
            <form class="py__settings-form" method="post" action="/save/<%= (user && !isAdmin) ? 'users/' + user._id + '/themes/' + id : id %>" aria-multiline="true">
                <% if(settings && settingsSchema){ %> 
                    <% settingsSchema?.forEach(comp => { %>
                        <% if(comp?.name === 'Global Styles'){ %>
                            <% if(comp?.settings){ %>
                                <div class="py__random-settings-wrap py__settings-section-item">
                                <% comp?.settings?.forEach((item, index) => { %>
                                    <% if(index > 11 && item.id){ %>
                                        <input type="hidden" name="<%=item.id%>" value="<%=settings[item.id]%>"/>
                                    <% } %>
                                    <% if(index > 11) return; %>
                                    <% if(item.type === 'header'){ %>
                                        <div class="py__random-item-wrapper">
                                            <div class="py__random-item-name">
                                                <span><%= item.content %></span>
                                            </div>
                                            <div class="py__random-item-content">
                                    <% } %>
                                        <% if(item.type === "color"){ %>
                                            <div class="py__random-comp py__random_comp-color component-is-color">
                                                <label for="settings-<%=item.id%>" class="py__label-for-color" <% if(settings[item.id]){ %>style="background:<%=settings[item.id]%>;"<% } %>>
                                                    <input type="color" id="settings-<%=item.id%>" name="<%=item.id%>" <% if(settings[item.id]){ %>value="<%=settings[item.id]%>"<% } %>/>
                                                </label>
                                                <span><%=item.label%></span>
                                            </div>
                                        <% } %>
                                    <% if(index === 5 || index === 11){ %>
                                            </div>
                                        </div>
                                    <% } %>
                                <% }) %>
                                </div>
                            <% } %>
                        <% } else { %>
                            <% if(comp.settings){ %>
                                <div class="py__random-settings-wrap py__settings-section-item">
                                    <% comp.settings.forEach((item, index) => { %>
                                        <% if(item.type === "textarea" && item.label === "Custom Font"){ %>
                                            <% if(item?.id?.includes('heading') || item?.id?.includes('title') || item?.id?.includes('sub_title') || item?.id?.includes('body')){ %>
                                                <div class="py__random-comp py__random-comp-select">
                                                    <label for="settings-<%=item.id%>"><%=item.label%></label>
                                                    <select name="<%=item.id %>" id="settings-<%=item.id%>"type="select">
                                                        <% fonts?.items?.forEach(font => { %>
                                                            <option value="<%=font.family%>" <% if(font.family === settings[item?.id]){ %>selected<% } %>>
                                                                <%= font.family %>
                                                            </option>
                                                        <% }) %>
                                                    </select>
                                                </div>
                                            <% } %>
                                        <% } %>
                                    <% }) %>
                                </div>
                            <% } %>
                        <% } %>
                    <% }) %>
                <% } %>
                <% if(sections && sectionsSchema){ %>
                    <% sections?.order?.forEach((orderItem,index)=>{ %>
                        <% let sectionItem = sections?.sections[orderItem] %>
                        <% let sectionSchemaItem = sectionsSchema?.filter(sectionSchemaItem => sectionSchemaItem.file_name === sectionItem.type) %>
                        <% if(sectionItem?.settings || sectionItem?.block_order?.length){ %>
                        <div class="py__random-section-item py__closest">
                            <% if(sectionItem?.settings){ %>
                                <div class="py__random-section-content py__settings-section-item" data-section-handle="<%=sectionItem.type%>" data-section-id="<%=orderItem%>" data-template-name="<%=sectionSchemaItem[0].template_name%>">
                                    <% sectionSchemaItem[0].settings.forEach((item,index)=>{ %>
                                        <% if(item.type === "select" && item?.id?.includes('style') || item.type === "select" && item?.id?.includes('position') || item.type === "select" && item?.id?.includes('color')){ %>
                                            <div class="py__random-comp py__random-comp-select">
                                                <label for="section-<%=item.id%>"><%=item.label%></label>
                                                <select name="<%=item.id %>" id="section-<%=item.id%>"type="select">
                                                    <% item.options.forEach(option => { %>
                                                        <option value="<%= option.value %>" <% if(sectionItem?.settings[item.id] === option.value){ %>selected<% } %>><%= option.label %></option>
                                                    <% }) %>
                                                </select>
                                            </div>
                                        <% } else if(item.id){ %>
                                            <input type="hidden" name="<%=item.id%>" value="<%=sectionItem?.settings[item.id]%>"/>
                                        <% } %>
                                    <% }) %>
                                </div>
                            <% } %>
                            <% if(sectionItem?.block_order?.length){ %>
                                <% sectionItem?.block_order?.forEach((blockOrder,index)=>{ %>
                                    <% let blockItem = sectionItem?.blocks[blockOrder] %>
                                    <% let schemaBlockItem = sectionSchemaItem[0]?.blocks?.filter(block => block?.type === blockItem?.type) %>
                                    <% if(schemaBlockItem[0]?.settings){ %>
                                        <div class="py__random-block-wrap py__settings-block-item" data-block-type="<%=blockItem?.type%>" data-block-id="<%=blockOrder%>">
                                            <% schemaBlockItem[0].settings.forEach((item,index)=>{ %>
                                                <% if(item.type === "select" && item?.id?.includes('style') || item.type === "select" && item?.id?.includes('position') || item.type === "select" && item?.id?.includes('color')){ %>
                                                    <div class="py__random-comp py__random-comp-select">
                                                        <label for="<%= "block_" + item.id %>"><%=item.label%></label>
                                                        <select name="block_<%=item.id%>" type="select">
                                                            <% item.options.forEach(option => { %>
                                                                <option value="<%=option.value%>" <% if(blockItem?.settings[item.id] === option.value){ %>selected<% } %>><%=option.label%></option>
                                                            <% }) %>
                                                        </select>
                                                    </div>
                                                <% } else if(item.id){ %>
                                                    <input type="hidden" name="block_<%=item.id%>" value="<%=blockItem?.settings[item.id]%>"/>
                                                <% } %>
                                            <% }) %>
                                        </div>
                                    <% } %>
                                <% }) %>
                            <% } %>
                        </div>
                        <% } %>
                    <% }) %>
                <% } %>
            </form>
        </div>
        <script src="https://js.stripe.com/v3/"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/2.4.2/chroma.min.js" integrity="sha512-zInFF17qBFVvvvFpIfeBzo7Tj7+rQxLeTJDmbxjBz5/zIr89YVbTNelNhdTT+/DCrxoVzBeUPVFJsczKbB7sew==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
        <script src="/javascripts/make.js"></script>
        <div class="py__loading-wrap">
            <div class="py__loading">
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
                <div></div>
            </div>
        </div>
    </body>
</html>
