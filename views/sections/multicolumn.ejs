<link rel="stylesheet" href="/assets/section-multicolumn.css">
<link rel="stylesheet" href="/assets/component-slider.css">

<div class="multicolumn background-<%= section.settings.background_style %><% if(!section.settings.title){ %> no-heading<% } %>">
  <div class="page-width">
    <div class="title-wrapper-with-link title-wrapper--self-padded-mobile<% if(!section.settings.title){ %> title-wrapper-with-link--no-heading<% } %>">
      <h2 class="title">
        <%= section.settings.title %>
      </h2>
      <% if(section.settings.button_label && section.settings.swipe_on_mobile){ %>
        <a href="<%= section.settings.button_link %>" class="link underlined-link large-up-hide"><%= section.settings.button_label %></a>
      <% } %>
    </div>
    <slider-component class="slider-mobile-gutter">
      <ul class="multicolumn-list grid grid--1-col<% if(section.blocks.length > 3 && section.settings.image_width !== 'full'){ %> grid--2-col-tablet grid--4-col-desktop<% } else if(section.blocks.length > 3 && section.settings.image_width === 'full'){ %> grid--2-col-tablet<% } else { %> grid--3-col-tablet<% } %><% if(section.settings.swipe_on_mobile && section.blocks.length > 1){ %> slider slider--mobile grid--peek<% } %>"
        id="Slider-1>"
        role="list"
      >
        <%
          var highest_ratio = 0
          section.blocks.forEach((block, index) => {
            if(block.settings?.image?.aspect_ratio > highest_ratio){
              highest_ratio = block.settings?.image?.aspect_ratio
            }
          })
        %>
        <% section.blocks.forEach((block, index) => { %>
          <li class="multicolumn-list__item grid__item<% if(section.settings.swipe_on_mobile){ %> slider__slide<% } %><% if(section.settings.column_alignment === 'center'){ %> center<% } %>">
            <div class="multicolumn-card">
              <% if(block.settings?.image){ %>
                <% if(section.settings.image_ratio === 'adapt' || section.settings.image_ratio === 'circle'){ %>
                  <% var spaced_image = true %>
                <% } %>
                <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--<%= section.settings.image_width %>-width<% if(section.settings.image_width !== 'full' || spaced_image){ %> multicolumn-card-spacing<% } %>">
                  <div class="media media--transparent media--<%= section.settings.image_ratio %>"
                    <% if(section.settings.image_ratio === 'adapt'){ %>
                      style="padding-bottom: <%= 1 / (highest_ratio * 100) %>%;"
                    <% } %>>
                    <img
                      srcset="<% if(block.settings?.image.width >= 275){ %><%= block.settings?.image %> 275w,<% } %>
                        <% if(block.settings?.image.width >= 550){ %><%= block.settings?.image %> 550w,<% } %>
                        <% if(block.settings?.image.width >= 710){ %><%= block.settings?.image %> 710w,<% } %>
                        <% if(block.settings?.image.width >= 1420){ %><%= block.settings?.image %> 1420w,<% } %>"
                      src="<%= block.settings?.image %>"
                      sizes="(min-width: 990px) <% if(section.blocks.length <= 2){ %>710px<% } else { %>550px<% } %>,
                        (min-width: 750px) <% if(section.blocks.length === 1){ %>710px<% } else { %>550px<% } %>,
                        calc(100vw - 30px)"
                      alt="<%= block.settings?.title %>"
                      height="<%= block.settings?.image.height %>"
                      width="<%= block.settings?.image.width %>"
                      loading="lazy"
                    >
                  </div>
                </div>
              <% } else { %>
                <% if(section.settings.image_ratio === 'adapt' || section.settings.image_ratio === 'circle'){ %>
                  <% var spaced_image = true %>
                <% } %>
                <div class="multicolumn-card__image-wrapper multicolumn-card__image-wrapper--<%= section.settings.image_width %>-width<% if(section.settings.image_width !== 'full' || spaced_image){ %> multicolumn-card-spacing<% } %>">
                  <div class="media media--transparent media--<%= section.settings.image_ratio %>"
                    <% if(section.settings.image_ratio === 'adapt'){ %>
                      style="padding-bottom: <%= 1 / 1 * 100 %>%;"
                    <% } %>>
                    <img src="/images/multicolumn-<%= index %>.jpg" loading="lazy"/>
                  </div>
                </div>
              <% } %> 
              <div class="multicolumn-card__info">
                <h3><%= block.settings?.title ? block.settings?.title : 'Title' %></h3>
                <div class="rte"><%- block.settings?.text ? block.settings?.text : "<p>Description Content Is Here!</p>" -%></div>
              </div>
            </div>
          </li>
        <% }) %>
      </ul>

      <% if(section.settings.swipe_on_mobile){ %>
        <div class="slider-buttons no-js-hidden medium-hide<% if(section.blocks.length < 2){ %> small-hide<% } %>">
          <div class="slider-counter caption">
            <span class="slider-counter--current">1</span>
            <span aria-hidden="true"> / </span>
            <span class="visually-hidden">accessibility of</span>
            <span class="slider-counter--total"><%= section.blocks.length %></span>
          </div>
          <button type="button" class="slider-button slider-button--prev" name="previous" aria-label="previous slide"><%- include('../snippets/icon-caret') %></button>
          <button type="button" class="slider-button slider-button--next" name="next" aria-label="next slide"><%- include('../snippets/icon-caret') %></button>
        </div>
      <% } %>
    </slider-component>
    <div class="center<% if(section.settings.swipe_on_mobile){ %> small-hide medium-hide<% } %>">
      <% if(section.settings.button_label){ %>
        <a class="button button--primary"<% if(!section.settings.button_link){ %> aria-disabled="true" role="link"<% } else { %> href="<%= section.settings.button_link %>"<% } %>>
          <%= section.settings.button_label %>
        </a>
      <% } %>
    </div>
  </div>
</div>